---
###############################################################
#                   Authelia configuration                    #
###############################################################

# Server Configuration
server:
  host: 0.0.0.0
  port: 9091

# Logging
log:
  level: info

# Theme
theme: light

# JWT Secret (generate with: openssl rand -base64 32)
jwt_secret: CHANGE_ME_GENERATE_RANDOM_STRING

# Default Redirection URL
default_redirection_url: https://yourdomain.com

# TOTP Configuration (Time-based One-Time Password for 2FA)
totp:
  disable: true  # Set to false to enable authenticator app 2FA
  issuer: yourdomain.com
  period: 30
  skew: 1

# WebAuthn Configuration (Hardware keys like YubiKey)
webauthn:
  disable: true

# Identity Validation - for password reset functionality
identity_validation:
  reset_password:
    jwt_secret: CHANGE_ME_GENERATE_RANDOM_STRING

# Authentication Backend (FreeIPA LDAP)
authentication_backend:
  ldap:
    implementation: custom
    url: ldap://your-freeipa-server.com:389
    timeout: 5s
    start_tls: true  # Required for password changes in FreeIPA
    tls:
      skip_verify: true  # Set to false if you have proper certificates
    base_dn: cn=accounts,dc=example,dc=com
    username_attribute: uid
    additional_users_dn: cn=users
    users_filter: (&({username_attribute}={input})(objectClass=person))
    additional_groups_dn: cn=groups
    groups_filter: (&(member={dn})(objectClass=groupOfNames))
    group_name_attribute: cn
    mail_attribute: mail
    display_name_attribute: displayName
    user: uid=ldapauth,cn=sysaccounts,cn=etc,dc=example,dc=com
    password: YOUR_LDAPAUTH_PASSWORD

# Access Control Rules
access_control:
  default_policy: deny
  rules:
    # Allow everyone to access auth portal
    - domain: auth.yourdomain.com
      policy: bypass
    # Protect your applications
    - domain: "*.yourdomain.com"
      policy: one_factor  # Change to two_factor if TOTP is enabled

# Session Configuration
session:
  name: authelia_session
  domain: yourdomain.com  # Root domain for SSO
  same_site: lax
  secret: CHANGE_ME_GENERATE_RANDOM_STRING
  expiration: 1h
  inactivity: 5m
  remember_me_duration: 1M
  redis:
    host: redis
    port: 6379

# Regulation (brute force protection)
regulation:
  max_retries: 5
  find_time: 2m
  ban_time: 5m

# Storage (local SQLite database)
storage:
  encryption_key: CHANGE_ME_GENERATE_RANDOM_STRING
  local:
    path: /config/db/db.sqlite3

# Notifier (SMTP for email notifications)
notifier:
  disable_startup_check: false
  smtp:
    host: smtp.example.com  # Your SMTP server
    port: 587
    timeout: 5s
    username: your-email@example.com
    password: YOUR_SMTP_PASSWORD
    sender: "Authelia <your-email@example.com>"
    identifier: localhost
    subject: "[Authelia] {title}"
    startup_check_address: test@authelia.com
    disable_require_tls: false
    disable_html_emails: false
    tls:
      skip_verify: false
