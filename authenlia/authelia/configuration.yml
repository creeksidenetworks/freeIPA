---
###############################################################################
#                           Authelia Configuration                            #
###############################################################################

theme: light

server:
  host: 0.0.0.0
  port: 9091
  path: ""
  asset_path: ""

log:
  level: info
  format: text

# TOTP Configuration
totp:
  disable: false
  issuer: authelia.com
  algorithm: sha1
  digits: 6
  period: 30
  skew: 1
  secret_size: 32

# WebAuthn Configuration (optional, for hardware keys)
webauthn:
  disable: true

# Duo Push API (optional, disable for now)
duo_api:
  disable: true

# Authentication Backend - FreeIPA LDAP
authentication_backend:
  password_reset:
    disable: false
  refresh_interval: 5m
  
  ldap:
    implementation: custom
    url: ldap://ipa1.insc.lcl
    timeout: 5s
    start_tls: false
    tls:
      skip_verify: false
      minimum_version: TLS1.2
    
    # FreeIPA base DN - adjust this to match your domain
    base_dn: dc=insc,dc=lcl
    
    # FreeIPA users base DN
    additional_users_dn: cn=users,cn=accounts
    
    # FreeIPA user filter
    users_filter: (&(|({username_attribute}={input})({mail_attribute}={input}))(objectClass=person))
    
    # FreeIPA username attribute
    username_attribute: uid
    
    # FreeIPA mail attribute
    mail_attribute: mail
    
    # FreeIPA display name attribute
    display_name_attribute: displayName
    
    # FreeIPA groups base DN
    additional_groups_dn: cn=groups,cn=accounts
    
    # FreeIPA group filter
    groups_filter: (&(member={dn})(objectClass=groupOfNames))
    
    # FreeIPA group name attribute
    group_name_attribute: cn
    
    # Service account for LDAP binding
    user: uid=authelia,cn=users,cn=accounts,dc=insc,dc=lcl
    password: YOUR_LDAP_BIND_PASSWORD

# Access Control Configuration
access_control:
  default_policy: deny
  
  rules:
    # Authelia portal - bypass authentication for the login page
    - domain: auth.innosilicon.com
      policy: bypass
      resources:
        - "^/api/.*$"
    
    # FreeIPA - require authentication
    - domain: ipa1.innosilicon.com
      policy: two_factor
      subject:
        - "group:admins"
        - "group:ipausers"
    
    # Alternative: Allow all authenticated users to access FreeIPA
    # - domain: ipa1.innosilicon.com
    #   policy: one_factor

# Session Configuration
session:
  name: authelia_session
  domain: innosilicon.com
  same_site: lax
  secret: YOUR_SESSION_SECRET_CHANGE_ME
  expiration: 1h
  inactivity: 5m
  remember_me_duration: 1M
  
  redis:
    host: redis
    port: 6379
    password: ""
    database_index: 0
    maximum_active_connections: 8
    minimum_idle_connections: 0

# Regulation to prevent brute force attacks
regulation:
  max_retries: 5
  find_time: 2m
  ban_time: 5m

# Storage Backend
storage:
  encryption_key: YOUR_STORAGE_ENCRYPTION_KEY_CHANGE_ME
  
  local:
    path: /config/db.sqlite3

# Notification Provider (file-based for testing)
notifier:
  disable_startup_check: false
  
  filesystem:
    filename: /config/notification.txt

# Optional: SMTP configuration for password reset emails
#  smtp:
#    username: your-email@example.com
#    password: your-email-password
#    host: smtp.gmail.com
#    port: 587
#    sender: authelia@innosilicon.com
#    identifier: localhost
#    subject: "[Authelia] {title}"
#    startup_check_address: test@authelia.com
#    disable_require_tls: false
#    disable_html_emails: false
#    tls:
#      skip_verify: false
#      minimum_version: TLS1.2
